\documentclass{article}

%% for images
\usepackage{graphicx}
\graphicspath{ {images/} }

%% language support
\usepackage[T1,T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{tikz}
\usepackage{geometry}
\geometry{margin=0.5in}

%% hyperrefs
\usepackage{hyperref}
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}

\title{2024}
\author{КЫК и его друзья}

\begin{document}
\maketitle
\tableofcontents

\part{КЯК парсер}
Рассмотрим пример грамматики ниже. Возьмём для разбора строку $baaba$.
$$\ \ \ \ S \to AB \ | \ BC $$
$$A \to BA \ | \ a $$
$$B \to CC \ | \ b $$
$$C \to AB \ | \ a $$
Суть КЯК в рассмотрении подстрок от самых маленьких к целой строке. 
По итогу нам нужно узнать, является ли строка каким-то из нетерминалов 
(т.е. словом языка, порождённого грамматикой). Если совсем кратко -
принадлежит ли строка языку.
\\\\
Приступим к разбору. Ещё раз напомню, что мы его ведём снизу вверх - 
от терминалов к нетерминалам и так пока не охватим всю строку.
$$B \to b$$
$$A \to a$$
$$C \to a$$
Идём дальше. Это были подстроки длины 1. $baaba$ также имеет подстроки длины 2,
которые формируются из подстрок длины 1 ($\times$ - декартово произведение):
$$ba = b\times a = B \times A = BA = A$$
$$ba = b\times a = B \times C = BC = S$$
Пока у нас есть $A \to ba, S \to ba$. 
Которые получаются, как мы выяснили, вот так:
$$ A \to BA \to bA \to ba$$
$$ S \to BC \to bC \to ba$$
Тупо последовательно заменяем нетерминалы, пока не доберёмся до терминалов.
К сожалению, дальше мы упоремся и запутаемся, если будем так продолжать. 
Это была всего лишь первая 2-подстрока, а я уже устала.\\
Видимо, кто-то из авторов тоже устал, и придумал лестницу КЯК или как она там. 
Выглядит она следующим образом (цифры - длины подстрок, НТ - нетерминалы):\\
\begin{center}
    \begin{tabular}{ c|c c c c c }
    5 & НТ \\ 
    4 & НТ & НТ  \\  
    3 & НТ & НТ & НТ   \\  
    2 & НТ & НТ & НТ & НТ  \\  
    1 & НТ & НТ & НТ & НТ & НТ  \\
    \hline
      & b  &  a &  a & b  &  a 
    \end{tabular}
\end{center}
Эта таблица показывает, из каких нетерминалов какую строку мы можем построить.
Пока что для нас она выглядит так:
\begin{center}
    \begin{tabular}{ c|c c c c c }
    5 & НТ  \\ 
    4 & НТ & НТ   \\  
    3 & НТ & НТ & НТ   \\  
    2 & НТ & НТ & НТ & НТ  \\  
    1 & B & A,C & A,C & B & A,C  \\
    \hline
      & b  &  a &  a & b  &  a 
    \end{tabular}
\end{center}
И, учитывая что мы уже успели проанализировать первое $ba$:
\begin{center}
    \begin{tabular}{ c|c c c c c }
    5 & НТ  \\ 
    4 & НТ & НТ   \\  
    3 & НТ & НТ & НТ   \\  
    2 & S,A & НТ & НТ & НТ  \\  
    1 & B & A,C & A,C & B & A,C  \\
    \hline
      & b  &  a &  a & b  &  a 
    \end{tabular}
\end{center}
Теперь давайте заполнять эту таблицу. Для следующих подстрок мы получим:
$$aa = a\times a = A,C \times A,C = AA, CA, AC, CC = B$$
$$ab = a\times b = A,C \times B = AB, CB = S, C$$
$$bb = b\times b = B \times B = \varnothing$$
\begin{center}
    \begin{tabular}{ c|c c c c c }
    5 & НТ \\ 
    4 & НТ & НТ   \\  
    3 & НТ & НТ & НТ   \\  
    2 & S,A & B & S,C & S,A  \\  
    1 & B & A,C & A,C & B & A,C  \\
    \hline
      & b  &  a &  a & b  &  a 
    \end{tabular}
\end{center}
Строки длины 3.
$$baa = b\times aa = B \times B = BB = \varnothing$$
$$baa = ba\times a = S,A \times A,C = SA, AA, SC, AC = \varnothing$$
$$aab = a\times ab = A,C \times S,C = AS, CS, AC, CC = B$$
$$aab = aa\times b = B \times B = \varnothing$$
$$aba = a\times ba = A,C \times S,A = AS, CS, AA, CA = \varnothing$$
$$aba = ab\times a = S,C \times A,C = SA, CA, SC, CC = B$$
\begin{center}
    \begin{tabular}{ c|c c c c c }
    5 & НT \\ 
    4 & НТ & НТ   \\  
    3 & $\varnothing$ & B & B   \\  
    2 & S,A & B & S,C & S,A  \\  
    1 & B & A,C & A,C & B & A,C  \\
    \hline
      & b  &  a &  a & b  &  a 
    \end{tabular}
\end{center}
Строки длины 4.
$$baab = b\times aab = B \times B = BB = \varnothing$$
$$baab = ba\times ab = S,A \times S,C = SS, AS, SC, AC = \varnothing$$
$$baab = baa\times b = \varnothing \times B = \varnothing$$
$$aaba = a\times aba = A,C \times B = AB, CB = S, C$$
$$aaba = aa\times ba = B \times S,A = BS, BA = A$$
$$aaba = aab\times a = B \times A,C = BA, BC = A,S$$
\begin{center}
    \begin{tabular}{ c|c c c c c }
    5 & НТ  \\ 
    4 & $\varnothing$ & S,A,C   \\  
    3 & $\varnothing$ & B & B   \\  
    2 & S,A & B & S,C & S,A  \\  
    1 & B & A,C & A,C & B & A,C  \\
    \hline
      & b  &  a &  a & b  &  a 
    \end{tabular}
\end{center}
Строки длины 5. 
$$baaba = b\times aaba = B \times S,A,C = BS, BA, BC = A, S$$
$$baaba = ba\times aba = S,A \times B = SA, AB = S,C$$
$$baaba = baa\times ba = \varnothing \times S,A = \varnothing$$
$$baaba = baab\times a = \varnothing \times A,C = \varnothing$$
\begin{center}
    \begin{tabular}{ c|c c c c c }
    5 & S,A,C  \\ 
    4 & $\varnothing$ & S,A,C   \\  
    3 & $\varnothing$ & B & B   \\  
    2 & S,A & B & S,C & S,A  \\  
    1 & B & A,C & A,C & B & A,C  \\
    \hline
      & b  &  a &  a & b  &  a 
    \end{tabular}
\end{center}
Таким образом, строка может быть получена путем последовательного раскрытия
(развертки) нетерминалов S, A, C.\\\\
УПРАЖНЕНИЕ. 
Убедиться, что все указанные нетерминалы преобразуются в искомую строку. 
\part{LL1 парсер}
Всё начинается с таблицы парсинга. Для составления таблицы необходимо вначале 
посчитать множества символов FIRST и FOLLOW для каждого нетерминала NT. 
\\Заметим, что первое правило грамматики для стартового нетерминала, 
если не указано иное. После стартового нетерминала может 
идти конец строки, для остальных в общем случае это неверно.
Рассмотрим следующую грамматику:
$$A \to CB $$
$$B \to +CB \ | \ \epsilon $$
$$C \to ED $$
$$D \to *ED \ | \ \epsilon$$
$$E \to id \ | \ (A)$$
FIRST(NT) - множество символов на первой позиции строки NT (aka begin()):\\
$$FIRST(A)=FIRST(C)$$
$$FIRST(B)=\ '+' \cup \ \epsilon$$
$$FIRST(C)=FIRST(E)$$
$$FIRST(D)=\ '*' \cup \ \epsilon$$
$$FIRST(E)=\ 'id' \cup \ '('$$
FOLLOW(NT) - множество символов на первой после последней
позиции строки NT (aka end()) (т.е.  \\ 
1) если видим $P \to ... NT \ Q$, то 
добавляем $FIRST(Q)$ (если $Q$ непусто) и $FOLLOW(P)$ \\
2) если $Q$ может быть $\epsilon$, то добавляем $FOLLOW(Q)$ \\
3) $\epsilon$ не может быть в FOLLOW, если появляется, то его надо убрать)
$$FOLLOW(A)=\ ')' \cup \ '\$' $$
$$FOLLOW(B)=FOLLOW(A)$$
$$FOLLOW(C)=FIRST(B) \cup FOLLOW(A) \cup FOLLOW(B)\ \setminus \epsilon$$
$$FOLLOW(D)=FOLLOW(C) \ \setminus \epsilon$$
$$FOLLOW(E)=FIRST(D) \cup FOLLOW(C) \cup FOLLOW(D)\ \setminus \epsilon$$
Получм:\\
\begin{center}
  \begin{tabular}{ c|c|c }
    NT & FIRST & FOLLOW         \\
    \hline
    A &  id, ( & ), \$          \\
    \hline
    B &  +, $\epsilon$ & ), \$    \\
    \hline
    C &  id, ( & +, ), \$       \\
    \hline
    D &  *, $\epsilon$ & +, ), \$ \\
    \hline
    E &  id, ( & *, +, ), \$ 
  \end{tabular}
\end{center}
Теперь, таблица парсинга. Она содержит производящие правила на пересечении 
терминалов и нетерминалов. Заполняется
она так для каждого нетерминала NT:\\
1. Если $\epsilon \in FIRST(NT)$, то пишем правило, которым 
получился $\epsilon$, во всех строках из FOLLOW(NT).\\
2. Для всех прочих символов (не \$) из FIRST(NT)
в соответствующих столбцах пишется правило, которым этот символ был получен.
\begin{center}
  \begin{tabular}{ c|c|c|c|c|c|c }
    NT/T & id          & (            & + & ) & * & \$  \\
    \hline
    A    & $A \to CB $ & $A \to CB $  &   &   &   &     \\
    \hline
    B    &             &              &  $B \to +CB$ & $B \to \epsilon$  &   & $B \to \epsilon$     \\
    \hline
    C    & $C \to ED $ & $C \to ED $  &   &   &   &     \\
    \hline
    D    &             &              &  $D \to \epsilon$ & $D \to \epsilon$  &  $D \to *ED $ & $D \to \epsilon$     \\
    \hline
    E    & $E \to id $ & $E \to (A) $ &   &   &   &     \\
  \end{tabular}
\end{center}
Удивительно, но алгоритм предельно прост. Мы всего лишь инициализируем 
стек стартовым нетерминалом, а в конец рассматриваемой строки добавляем
конечный символ \$.\\\\
Далее происходит следующее. Мы достаём символ из строки и нечто со стека.
Если нечто - терминал и совпало с символом, то $pop$
и двигаем текущий символ. Если не совпало - ошибка. (При любой ошибке 
выходим из цикла.)\\
Если же нечто - нетерминал, то мы ищем в таблице запись на пересечении
нечто и текущего символа строки. Если запись не найдена, то ошибка.
Иначе $pop$. 
Правая часть записи добавляется в стек, так что первый её элемент наверху.
\\\\ 
Так повторяется, пока текущий символ не станет концом строки или не 
будет получена ошибка. Если ошибок не было, то строка принадлежит языку.
\\\\
Рассмотрим пример. Грамматика
$$S^{'} \to S\$$$
$$S \to xYzS \ | \ a$$
$$Y \to xYz \ | \ y$$
и строки $xxyzza$ и $xxyzzz$.\\
Таблица 1:
\begin{center}
  \begin{tabular}{ c|c|c }
    NT & FIRST & FOLLOW         \\
    \hline
    $S^{'}$ &  x,a & \$          \\
    \hline
    S &  x,a & \$    \\
    \hline
    Y &  x,y & z,\$       
  \end{tabular}
\end{center}
Таблица 2:
\begin{center}
  \begin{tabular}{ c|c|c|c|c|c }
    NT/T & a          & x            & y & z & \$  \\
    \hline
    $S^{'}$    & $S^{'} \to S\$$ & $S^{'} \to S\$$  &   &   &        \\
    \hline
    S    &  $S \to a$   &  $S \to xYzS$ &  &   &     \\
    \hline
    Y    & & $Y \to xYz$  & $Y \to y$  &   &        
  \end{tabular}
\end{center}
Начинаем разбор строки $xxyzza$:\\\\
Стек: $S^{'}$\\
Строка: $xxyzza\$$\\
Символ: x\\
Нечто - $S^{'}$\\
Нечто - нетерминал, и потому ищем пересечение $S^{'}$ и x. 
Находим $S^{'} \to S\$$.\\
Стек: $\$S$\\
\\
Строка: $xxyzza\$$\\
Символ: x\\
Нечто - $S$\\
Нечто - нетерминал, и потому ищем пересечение $S$ и x. 
Находим $S \to xYzS$.\\
Стек: $\$SzYx$\\
\\
Строка: $xxyzza\$$\\
Символ: x\\
Нечто - x\\
Нечто - терминал, и он совпал с текущим символом.\\
Стек: $\$SzY$\\
Строка: $xyzza\$$\\
\\
Символ: x\\
Нечто - Y\\
Нечто - нетерминал, и потому ищем пересечение $Y$ и x. 
Находим $Y \to xYz$.\\
Стек: $\$SzzYx$\\
\\
Строка: $xyzza\$$\\
Символ: x\\
Нечто - x\\
Нечто - терминал, и он совпал с текущим символом.\\
Стек: $\$SzzY$\\
Строка: $yzza\$$\\
\\
Символ: y\\
Нечто - Y\\
Нечто - нетерминал, и потому ищем пересечение $Y$ и y. 
Находим $Y \to y$.\\
Стек: $\$Szzy$\\
\\
Строка: $yzza\$$\\
Символ: y\\
Нечто - y\\
Нечто - терминал, и он совпал с текущим символом.\\
Стек: $\$Szz$\\
Строка: $zza\$$\\
\\
Символ: z\\
Нечто - z\\
Нечто - терминал, и он совпал с текущим символом.\\
Стек: $\$Sz$\\
Строка: $za\$$\\
\\
Символ: z\\
Нечто - z\\
Нечто - терминал, и он совпал с текущим символом.\\
Стек: $\$S$\\
Строка: $a\$$\\
\\
Символ: a\\
Нечто - S\\
Нечто - нетерминал, и потому ищем пересечение $S$ и a. 
Находим $S \to a$.\\
Стек: $\$a$\\
\\
Строка: $a\$$\\
Символ: a\\
Нечто - a\\
Нечто - терминал, и он совпал с текущим символом.\\
Стек: $\$$\\
Строка: $\$$\\
\\
Символ: \$\\
Нечто - \$\\
Нечто - \$, и он совпал с текущим символом.\\
Стек: $\empty$\\
Строка: $\empty$\\
\\
Стек опустел, значит цикл закончился. Ошибки не было, посему строка $xxyzza$
принадлежит языку.\\
\\
Теперь строка $xxyzzz$. Здесь всё то же самое до момента:\\\\
Стек: $\$Sz$\\
Строка: $zz\$$\\
\\
Символ: z\\
Нечто - z\\
Нечто - терминал, и он совпал с текущим символом.\\
Стек: $\$S$\\
Строка: $z\$$\\
\\
Символ: z\\
Нечто - S\\
Нечто - нетерминал, и потому ищем пересечение $S$ и z. Не нашли. ОШИБКА.
Выходим.\\
Таким образом, строка $xxyzzz$ не принадлежит языку.
\end{document}

